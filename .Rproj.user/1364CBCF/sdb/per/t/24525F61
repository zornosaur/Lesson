{
    "contents" : "# Spatial Analysis in R\n### Lesson Plan for Math 378\n__Christensen, Soren A., Lo, Rachel Y., Reed, Brian T.__\n\n__21 April 2015__\n\n### Introduction\n\nSpatial Statistics is a statistical method that uses space directly in the mathematical computations. Spatial Statistics uses distance, area, orientation or any other spacial relationships to analyze, predict, or model data sets where space is involved.\n\nThe concept of Spatial Statistics seems to have origins in cartography but throughout the year has contributed to botany (plants), ecology (environment), ethology (animal movement), epidemiology (disease), and economics. Today, it is most commonly used for the analysis of geographic data.\n\nSpatial statistics is unique from analytic methods commonly studied in an undergraduate-level statistics course. The differences can be seen  by the sheer number of difference in fundamental approach, forms of data, and  fields of applicable research.\n\n### Objectives\n\nIntroduce this area of statistics to class, give them exposure.\n\nBe familiar to applications of the package.\n\nTalk briefly about other packages.\n\nShow how this is applicable to being an analyst in the air force.\n\n### Example\n\nOne of the most important application of spatial analysis in wildlife tracking is home range estimation. Many mammals restrict their movements to a home range, rarely venturing far. By estimating an animals home range we can investigate what events effect the home range, and how it changes based on time. \n\nFor example see how these home ranges change from April to May to June.\n\n```{r include =FALSE}\nlibrary(dplyr)\nlibrary(adehabitatHR)\nlibrary(adehabitatLT)\n```\n\n```{r}\ntrack = read.csv(\"DeerSample.csv\")\ntrack = na.omit(track)\n\ntrack2 = filter(track, DATETIME >= 40634 & DATETIME <= 40663) #april\ntrack3 = filter(track, DATETIME >= 40664 & DATETIME <= 40694) #may\ntrack4 = filter(track, DATETIME >= 40695 & DATETIME <= 40724) #june\n\ntrack2S = SpatialPoints(data.frame(track2$LONGITUDE, track2$LATITUDE))\ntrack3S = SpatialPoints(data.frame(track3$LONGITUDE, track3$LATITUDE))\ntrack4S = SpatialPoints(data.frame(track4$LONGITUDE, track4$LATITUDE))\n\ntrack2K = kernelUD(track2S)\ntrack3K = kernelUD(track3S)\ntrack4K = kernelUD(track4S)\n\ntrack2H = getverticeshr(track2K)\ntrack3H = getverticeshr(track3K)\ntrack4H = getverticeshr(track4K)\n\nplot(track2H,col = 2)\nplot(track3H,col = 3, add = T)\nplot(track4H,col = 4, add = T)\n\nlegend(\"topright\", title=\"Months\", c(\"April\",\"May\",\"June\"), fill=c(2,3,4), horiz=F)\n```\n\nThe home range varies so much because female deer give birth in late May or early June.The deer is very active in April because she is eating for two, she moves around a lot to find sufficient nourishment. This deer most likely gave birth in late may, which is why the home range is smaller, but not as small as in June. In June the deer has given birth to a new fawn, which limits its movements.\n\nSome methods for calculating home ranges calculates them based off a percentile. One such method is the minimum convex polygon. This method creates the smallest possible convex home range which includes all the points in a certain percentile. These percentiles can be thought of as containing the percent of points which are closest to the center of mass of the entire distribution.\n\n```{r}\ntrackSp = SpatialPoints(data.frame(track$LONGITUDE, track$LATITUDE))\n\ntrackCp = mcp(trackSp, percent = 99)\ntrack90C = mcp(trackSp, percent = 90)\ntrack80C = mcp(trackSp, percent = 80)\ntrack70C = mcp(trackSp, percent = 70)\ntrack60C = mcp(trackSp, percent = 60)\ntrack50C = mcp(trackSp, percent = 50)\n\nplot(trackCp)\nplot(track90C, add = T, col = 2)\nplot(track80C, add = T, col = 3)\nplot(track70C, add = T, col = 4)\nplot(track60C, add = T, col = 5)\nplot(track50C, add = T, col = 6)\nplot(trackSp, add = T)\n\nlegend(\"topright\", title=\"Percentiles\", c(\"99\",\"90\",\"80\",\"70\",\"60\",\"50\"), fill=c(1,2,3,4,5,6), horiz=F)\n```\n\nThus far we have approached the data set as a set of independent points, but we know this is not true.If we look at the data set we imported we can see that it contains several other variables.\n\n```{r}\nhead(track)\n```\n\nThe individual points are not independent because a deer travels from one to the next, thus we need to take the DATETIME variable into account. We can consider two consecutive points as a transect, and we can consider the distance between two consecutive points as well as several other variables. The adehabitatLT package is ideal for this. Lets take a look at the month of March that we extracted above\n\n```{r}\ntrack1 = filter(track, DATETIME >= 40604 & DATETIME <= 40633)\ntrans1 = as.ltraj(xy = cbind(track1$LONGITUDE, track1$LATITUDE), date = as.POSIXct(track1$DATETIME  *60 * 60 *24, origin=\"1899-12-30\"), id = \"Deer\")\nhead(trans1[[1]])\nplot(trans1)\n```\n\nWe can see how the distance between points varries in the month of June.\n\n```{r}\ntrans4 = as.ltraj(xy = cbind(track4$LONGITUDE, track4$LATITUDE), date = as.POSIXct(track4$DATETIME  *60 * 60 *24, origin=\"1899-12-30\"), id = \"Deer\")\n\nscatter.smooth(trans4[[1]]$date, trans4[[1]]$dist)\n```\n\nWe see that the trend sharply decreases near the beginning of the month and then steadily increases. The dip is most likely representative of the birth of a fawn.\n\n### Readings\n\nMaterials for the students to review before class, and use as references while doing the homework.\n\nAn brief article which addresses the importance of spatial analysis in the world. This is important for the students to understand why this topic is being addressed. \n\nhttp://www.nytimes.com/2015/01/09/business/international/mapping-the-worlds-problems.html\n\nThis is an introductory vignette for basic exercises using adehabitatHR, as well as one for adehabitatLT.\n\nhttp://cran.r-project.org/web/packages/adehabitatHR/vignettes/adehabitatHR.pdf\nhttp://cran.r-project.org/web/packages/adehabitatLT/vignettes/adehabitatLT.pdf\n\nMain CRAN webpage for adehabtiatHR as well as one for adehabitatLT.\n\nhttp://cran.r-project.org/web/packages/adehabitatHR/index.html\nhttp://cran.r-project.org/web/packages/adehabitatLT/index.html\n\n### Homework Questions (with solutions)\n\nLoad the file DeerSample.csv this is a file containing real tracking data from a single deer on the USAFA reservation. \n\n__1. Find the area for the 80% home range in December__\n\n```{r}\ntrackDec = filter(track, DATETIME >= 40878.00 & DATETIME <= 40908.00)\ntrackDecS = SpatialPoints(data.frame(trackDec$LONGITUDE, trackDec$LATITUDE))\nmcp(trackDecS, percent = 80)\n```\n\n__2. Find the average transect distance for the deer in December__\n\n```{r}\ntrackDec = filter(track, DATETIME >= 40878.00 & DATETIME <= 40908.00)\ntransDec = as.ltraj(xy = cbind(trackDec$LONGITUDE, trackDec$LATITUDE), date = as.POSIXct(trackDec$DATETIME  *60 * 60 *24, origin=\"1899-12-30\"), id = \"Deer\")\n\nmean(na.omit(transDec[[1]]$dist))\n```\n\n__3. Find the average transect distance for the deer in June__\n\n```{r}\ntrackJun = filter(track, DATETIME >= 40695 & DATETIME <= 40724)\ntransJun = as.ltraj(xy = cbind(trackJun$LONGITUDE, trackJun$LATITUDE), date = as.POSIXct(trackJun$DATETIME  *60 * 60 *24, origin=\"1899-12-30\"), id = \"Deer\")\n\nmean(na.omit(transJun[[1]]$dist))\n```\n\n__4. What units are these distances and in?__\n\nDegrees, which does not mean much for us.\n\n__5. How could you convert these units to something that you can understand (requires some research online)?__\n\nWe need to convert the degrees from this projection into euclidean distances. One way to do this is to use the package rgdal, which pulls the projection operations from the PROJ.4 library. http://cran.r-project.org/web/packages/rgdal/rgdal.pdf\n\n__6. Why do you think the average distance is different between the two months?__\n\nJune is when the female deer give birth, thus they aren't moving very much. December is their mating season, so they are being chased around by male deer.\n\n__7. What are some different forms of home range estimation (requires some research online)?__\n\nMCP, several kernel methods: classical, brownian, product kernel. Local Convex Hull\n\n### References\n\nOther references that might be useful\n\nhttps://sites.google.com/site/rodriguezsanchezf/news/usingrasagis\n\nhttps://www.movebank.org/node/14620\n\nhttp://www.rdocumentation.org/packages/adehabitat\n\nhttp://core.ac.uk/download/pdf/26815643.pdf\n\nhttp://cran.r-project.org/web/packages/adehabitat/adehabitat.pdf\n\nhttp://www.mikemeredith.net/blog/1212_Data_for_home_range_analysis_in_R.htm#1\n\nhttp://cran.r-project.org/web/packages/adehabitatHR/vignettes/adehabitatHR.pdf",
    "created" : 1427831699755.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3358123777",
    "id" : "24525F61",
    "lastKnownWriteTime" : 1429677989,
    "path" : "~/Spring 2015/Math 378/Lesson/LessonPlan.Rmd",
    "project_path" : "LessonPlan.Rmd",
    "properties" : {
        "ignored_words" : "http,www,nytimes,adehabitatHR,cran,pdf,adehabtiatHR,adehabitat,https,google,rodriguezsanchezf,usingrasagis,csv,movebank,rdocumentation,uk\n",
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}